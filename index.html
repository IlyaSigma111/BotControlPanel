<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>J.A.R.V.I.S. - Интеллектуальная система</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
    
    <!-- Firebase SDK -->
    <script type="module">
        // Импорт Firebase
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
        import { getDatabase, ref, set, get, push, onValue, update, remove } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";

        // Конфигурация Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyAnvmm5Y7qnFSauN_cJLQ8gVNXfvKKHjhA",
            authDomain: "megajarvis-1380a.firebaseapp.com",
            projectId: "megajarvis-1380a",
            storageBucket: "megajarvis-1380a.firebasestorage.app",
            messagingSenderId: "201588214892",
            appId: "1:201588214892:web:0c51bbb0b247e5da171c49"
        };

        // Инициализация Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
        const auth = getAuth(app);

        // Экспорт в глобальную область видимости
        window.firebase = { database, ref, set, get, push, onValue, update, remove, auth, signInAnonymously, onAuthStateChanged };
        
        console.log("Firebase инициализирован!");
    </script>
</head>
<body>
    <!-- Контейнер -->
    <div class="container">
        <!-- Шапка -->
        <header class="header">
            <div class="logo">
                <div class="arc-reactor">
                    <div class="reactor-core"></div>
                </div>
                <div class="logo-text">
                    <h1 class="jarvis-title">J.A.R.V.I.S.</h1>
                    <p class="jarvis-subtitle">Mark XLII Protocol Active</p>
                </div>
                <div class="system-status">
                    <span class="status-dot" id="statusDot"></span>
                    <span class="status-text" id="statusText">CONNECTING...</span>
                </div>
            </div>
            
            <div class="header-controls">
                <div class="connection-status">
                    <i class="fas fa-database"></i>
                    <span id="dbStatus">Firebase: Подключение...</span>
                </div>
                <button class="btn-sync" onclick="syncData()">
                    <i class="fas fa-sync-alt"></i> Синхронизация
                </button>
            </div>
        </header>

        <!-- Боковая панель -->
        <nav class="sidebar">
            <div class="user-profile">
                <div class="avatar">
                    <i class="fas fa-user-astronaut"></i>
                </div>
                <div class="user-info">
                    <h3 id="userName">Загрузка...</h3>
                    <p>Система: <span class="access-level" id="userLevel">Онлайн</span></p>
                </div>
            </div>

            <ul class="nav-menu">
                <li class="active" data-tab="dashboard">
                    <i class="fas fa-desktop"></i>
                    <span>Главная</span>
                </li>
                <li data-tab="humor">
                    <i class="fas fa-laugh-beam"></i>
                    <span>Юмор-система</span>
                    <span class="badge" id="jokesCount">0</span>
                </li>
                <li data-tab="predictions">
                    <i class="fas fa-crystal-ball"></i>
                    <span>Прогностика</span>
                    <span class="badge" id="answersCount">0</span>
                </li>
                <li data-tab="users">
                    <i class="fas fa-users"></i>
                    <span>Пользователи</span>
                    <span class="badge" id="usersCount">0</span>
                </li>
                <li data-tab="analytics">
                    <i class="fas fa-chart-line"></i>
                    <span>Аналитика</span>
                </li>
                <li data-tab="settings">
                    <i class="fas fa-cogs"></i>
                    <span>Настройки</span>
                </li>
            </ul>

            <div class="system-info">
                <h4><i class="fas fa-server"></i> Статус Firebase</h4>
                <div class="db-stats">
                    <div class="stat-item">
                        <span>Шутки:</span>
                        <strong id="dbJokes">0</strong>
                    </div>
                    <div class="stat-item">
                        <span>Ответы:</span>
                        <strong id="dbAnswers">0</strong>
                    </div>
                    <div class="stat-item">
                        <span>Пользователи:</span>
                        <strong id="dbUsers">0</strong>
                    </div>
                    <div class="stat-item">
                        <span>Логи:</span>
                        <strong id="dbLogs">0</strong>
                    </div>
                </div>
                <button class="btn-backup" onclick="createBackup()">
                    <i class="fas fa-save"></i> Создать бэкап
                </button>
            </div>
        </nav>

        <!-- Основное содержимое -->
        <main class="main-content">
            <!-- Вкладка: Главная панель -->
            <section id="dashboard" class="tab-content active">
                <div class="tab-header">
                    <h2><i class="fas fa-desktop"></i> Системный монитор</h2>
                    <div class="ai-response-box">
                        <div class="voice-indicator">
                            <div class="voice-pulse"></div>
                            <div class="voice-pulse"></div>
                            <div class="voice-pulse"></div>
                        </div>
                        <p id="aiResponse">Инициализация систем... Подключение к базе данных...</p>
                    </div>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="activeUsers">0</h3>
                            <p>Активных пользователей</p>
                        </div>
                        <div class="stat-source">Firebase</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-joke"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="totalJokes">0</h3>
                            <p>Шуток в базе</p>
                        </div>
                        <div class="stat-source">Firebase</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-brain"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="totalAnswers">0</h3>
                            <p>Ответов шара</p>
                        </div>
                        <div class="stat-source">Firebase</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-comments"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="totalMessages">0</h3>
                            <p>Сообщений сегодня</p>
                        </div>
                        <div class="stat-source">Firebase</div>
                    </div>
                </div>

                <div class="dashboard-controls">
                    <h3><i class="fas fa-rocket"></i> Команды управления</h3>
                    <div class="controls-grid">
                        <button class="control-btn" onclick="addSampleData()">
                            <i class="fas fa-database"></i>
                            <span>Добавить тестовые данные</span>
                        </button>
                        <button class="control-btn" onclick="clearAllData()">
                            <i class="fas fa-trash"></i>
                            <span>Очистить базу</span>
                        </button>
                        <button class="control-btn" onclick="exportData()">
                            <i class="fas fa-file-export"></i>
                            <span>Экспорт данных</span>
                        </button>
                        <button class="control-btn" onclick="importData()">
                            <i class="fas fa-file-import"></i>
                            <span>Импорт данных</span>
                        </button>
                    </div>
                </div>

                <div class="realtime-data">
                    <h3><i class="fas fa-bolt"></i> Реальное время</h3>
                    <div class="data-stream" id="dataStream">
                        <!-- Данные в реальном времени -->
                    </div>
                </div>
            </section>

            <!-- Вкладка: Юмор-система -->
            <section id="humor" class="tab-content">
                <div class="tab-header">
                    <h2><i class="fas fa-laugh-beam"></i> Управление юмором</h2>
                    <div class="tab-actions">
                        <button class="btn-add" onclick="showAddJokeModal()">
                            <i class="fas fa-plus"></i> Добавить шутку
                        </button>
                        <button class="btn-refresh" onclick="loadJokes()">
                            <i class="fas fa-sync"></i> Обновить
                        </button>
                    </div>
                </div>

                <div class="joke-management">
                    <div class="joke-filters">
                        <input type="text" id="jokeSearch" placeholder="Поиск шуток..." onkeyup="searchJokes()">
                        <select id="categoryFilter" onchange="filterJokes()">
                            <option value="all">Все категории</option>
                            <option value="tech">Технические</option>
                            <option value="ai">ИИ-юмор</option>
                            <option value="stark">Старковские</option>
                            <option value="dark">Тёмный юмор</option>
                        </select>
                    </div>

                    <div class="jokes-container" id="jokesContainer">
                        <!-- Шутки загружаются из Firebase -->
                        <div class="loading">Загрузка шуток из базы данных...</div>
                    </div>
                </div>
            </section>

            <!-- Вкладка: Прогностика -->
            <section id="predictions" class="tab-content">
                <div class="tab-header">
                    <h2><i class="fas fa-crystal-ball"></i> Система предсказаний</h2>
                </div>

                <div class="prediction-system">
                    <div class="ball-section">
                        <div class="magic-ball" id="magicBall" onclick="shakeBall()">
                            <div class="ball-content">
                                <div class="triangle">
                                    <span class="ball-text" id="ballText">8</span>
                                </div>
                            </div>
                        </div>
                        <p class="ball-hint">Нажмите на шар для предсказания</p>
                    </div>

                    <div class="answers-management">
                        <h3><i class="fas fa-list"></i> База ответов</h3>
                        <div class="answers-list" id="answersList">
                            <!-- Ответы загружаются из Firebase -->
                        </div>
                        <div class="add-answer-form">
                            <input type="text" id="newAnswer" placeholder="Новый ответ...">
                            <button onclick="addAnswer()">
                                <i class="fas fa-plus"></i> Добавить
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Вкладка: Пользователи -->
            <section id="users" class="tab-content">
                <div class="tab-header">
                    <h2><i class="fas fa-users"></i> Управление пользователями</h2>
                </div>

                <div class="users-management">
                    <table class="users-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Имя</th>
                                <th>Тег</th>
                                <th>Дата регистрации</th>
                                <th>Шутки получено</th>
                                <th>Прогнозов</th>
                                <th>Действия</th>
                            </tr>
                        </thead>
                        <tbody id="usersTable">
                            <!-- Пользователи загружаются из Firebase -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Вкладка: Аналитика -->
            <section id="analytics" class="tab-content">
                <div class="tab-header">
                    <h2><i class="fas fa-chart-line"></i> Аналитика системы</h2>
                </div>

                <div class="analytics-dashboard">
                    <div class="chart-container">
                        <canvas id="jokesChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <canvas id="usersChart"></canvas>
                    </div>
                    <div class="stats-overview">
                        <div class="stat-box">
                            <h4>Популярные категории</h4>
                            <div id="categoryStats"></div>
                        </div>
                        <div class="stat-box">
                            <h4>Активность</h4>
                            <div id="activityStats"></div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Вкладка: Настройки -->
            <section id="settings" class="tab-content">
                <div class="tab-header">
                    <h2><i class="fas fa-cogs"></i> Настройки системы</h2>
                </div>

                <div class="settings-panel">
                    <div class="settings-section">
                        <h3><i class="fas fa-database"></i> Настройки Firebase</h3>
                        <div class="setting-item">
                            <label>Путь к базе:</label>
                            <input type="text" id="dbPath" value="jarvis/" readonly>
                        </div>
                        <div class="setting-item">
                            <label>Автосинхронизация:</label>
                            <label class="switch">
                                <input type="checkbox" id="autoSync" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="settings-section">
                        <h3><i class="fas fa-shield-alt"></i> Безопасность</h3>
                        <div class="setting-item">
                            <label>Ключ API:</label>
                            <div class="api-key">
                                <input type="password" id="apiKey" value="скрыто">
                                <button onclick="toggleApiKey()">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <!-- Терминал -->
        <div class="jarvis-terminal">
            <div class="terminal-header">
                <i class="fas fa-terminal"></i> Логи Firebase
                <button class="btn-clear" onclick="clearLogs()">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
            <div class="terminal-body">
                <div class="terminal-output" id="firebaseLogs">
                    <div class="log-entry">
                        <span class="timestamp">[12:00:00]</span>
                        <span class="log-message">Инициализация системы...</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Модальные окна -->
    <div id="addJokeModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-plus"></i> Новая шутка</h3>
                <button class="btn-close" onclick="closeModal('addJokeModal')">×</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Текст шутки:</label>
                    <textarea id="jokeText" rows="3" placeholder="Введите текст шутки..."></textarea>
                </div>
                <div class="form-group">
                    <label>Категория:</label>
                    <select id="jokeCategory">
                        <option value="tech">Техническая</option>
                        <option value="ai">ИИ-юмор</option>
                        <option value="stark">Старковская</option>
                        <option value="dark">Тёмный юмор</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button onclick="closeModal('addJokeModal')">Отмена</button>
                <button onclick="saveJokeToFirebase()" class="btn-primary">Сохранить в Firebase</button>
            </div>
        </div>
    </div>

    <div id="backupModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-save"></i> Бэкап данных</h3>
                <button class="btn-close" onclick="closeModal('backupModal')">×</button>
            </div>
            <div class="modal-body">
                <textarea id="backupData" rows="10" readonly></textarea>
            </div>
            <div class="modal-footer">
                <button onclick="downloadBackup()">Скачать JSON</button>
                <button onclick="copyBackup()">Копировать</button>
            </div>
        </div>
    </div>

    <!-- Скрипты -->
    <script src="script.js"></script>
</body>
</html>
